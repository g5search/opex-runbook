<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Domain Forwarder</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/opex-runbook/assets/css/0.styles.eb7c3e77.css" as="style"><link rel="preload" href="/opex-runbook/assets/js/app.b1c4424b.js" as="script"><link rel="preload" href="/opex-runbook/assets/js/2.83008ae0.js" as="script"><link rel="preload" href="/opex-runbook/assets/js/10.5dba1746.js" as="script"><link rel="prefetch" href="/opex-runbook/assets/js/11.2e108f7e.js"><link rel="prefetch" href="/opex-runbook/assets/js/12.8d951890.js"><link rel="prefetch" href="/opex-runbook/assets/js/13.e032895e.js"><link rel="prefetch" href="/opex-runbook/assets/js/14.52a8b68b.js"><link rel="prefetch" href="/opex-runbook/assets/js/15.7a6397ff.js"><link rel="prefetch" href="/opex-runbook/assets/js/16.841c3c7a.js"><link rel="prefetch" href="/opex-runbook/assets/js/17.59f76975.js"><link rel="prefetch" href="/opex-runbook/assets/js/18.a9f81dec.js"><link rel="prefetch" href="/opex-runbook/assets/js/19.9fce8cdc.js"><link rel="prefetch" href="/opex-runbook/assets/js/20.b91a0368.js"><link rel="prefetch" href="/opex-runbook/assets/js/3.b27e4937.js"><link rel="prefetch" href="/opex-runbook/assets/js/4.7c7cbcb6.js"><link rel="prefetch" href="/opex-runbook/assets/js/5.766016c4.js"><link rel="prefetch" href="/opex-runbook/assets/js/6.3a0262d0.js"><link rel="prefetch" href="/opex-runbook/assets/js/7.b14d29dc.js"><link rel="prefetch" href="/opex-runbook/assets/js/8.aba08b34.js"><link rel="prefetch" href="/opex-runbook/assets/js/9.c8b60c0a.js">
    <link rel="stylesheet" href="/opex-runbook/assets/css/0.styles.eb7c3e77.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/opex-runbook/" class="home-link router-link-active"><img src="/opex-runbook/midnight-g5-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/opex-runbook/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opex-runbook/getting-started/prerequisites/" class="nav-link">
  Prerequisites
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/getting-started/installation/" class="nav-link">
  Installation
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/postgres/" class="nav-link">
  Postgres
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/domain-forwarder/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Domain Forwarder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Testing Menu" class="dropdown-title"><span class="title">Testing</span> <span class="arrow down"></span></button> <button type="button" aria-label="Testing Menu" class="mobile-dropdown-title"><span class="title">Testing</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/general-testing-info/" class="nav-link">
  General Testing Info
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/unit-testing/" class="nav-link">
  Unit Testing
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/regression-testing/" class="nav-link">
  Regression Testing
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/smoke-testing/" class="nav-link">
  Smoke Testing
</a></li></ul></div></div><div class="nav-item"><a href="/opex-runbook/contributing/" class="nav-link">
  Contributing
</a></div><div class="nav-item"><a href="/opex-runbook/getting-started/contact/" class="nav-link">
  Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/opex-runbook/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opex-runbook/getting-started/prerequisites/" class="nav-link">
  Prerequisites
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/getting-started/installation/" class="nav-link">
  Installation
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/postgres/" class="nav-link">
  Postgres
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/domain-forwarder/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Domain Forwarder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Testing Menu" class="dropdown-title"><span class="title">Testing</span> <span class="arrow down"></span></button> <button type="button" aria-label="Testing Menu" class="mobile-dropdown-title"><span class="title">Testing</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/general-testing-info/" class="nav-link">
  General Testing Info
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/unit-testing/" class="nav-link">
  Unit Testing
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/regression-testing/" class="nav-link">
  Regression Testing
</a></li><li class="dropdown-item"><!----> <a href="/opex-runbook/testing/smoke-testing/" class="nav-link">
  Smoke Testing
</a></li></ul></div></div><div class="nav-item"><a href="/opex-runbook/contributing/" class="nav-link">
  Contributing
</a></div><div class="nav-item"><a href="/opex-runbook/getting-started/contact/" class="nav-link">
  Contact
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/opex-runbook/" aria-current="page" class="sidebar-link">Welcome to the OpEx Runbook!</a></li><li><a href="/opex-runbook/node/" class="sidebar-link">Configuring your Node.js Environment</a></li><li><a href="/opex-runbook/docker-k8s/" class="sidebar-link">Deployments using Docker and Kubernetes (aka K8s)</a></li><li><a href="/opex-runbook/postgres/" class="sidebar-link">All Things Postgres</a></li><li><a href="/opex-runbook/domain-forwarder/" aria-current="page" class="active sidebar-link">Domain Forwarder</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/opex-runbook/domain-forwarder/#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/opex-runbook/domain-forwarder/#point-the-domain" class="sidebar-link">Point the Domain</a></li><li class="sidebar-sub-header"><a href="/opex-runbook/domain-forwarder/#add-a-domain-to-the-domains-table" class="sidebar-link">Add a Domain to the Domains Table</a></li><li class="sidebar-sub-header"><a href="/opex-runbook/domain-forwarder/#add-the-redirect-rules-to-the-redirect-table" class="sidebar-link">Add the Redirect Rules to the Redirect Table</a></li><li class="sidebar-sub-header"><a href="/opex-runbook/domain-forwarder/#troubleshooting" class="sidebar-link">Troubleshooting</a></li></ul></li><li><a href="/opex-runbook/contributing/" class="sidebar-link">Contributing</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="domain-forwarder"><a href="#domain-forwarder" class="header-anchor">#</a> Domain Forwarder</h1> <p>So OpEx made a redirect manager for domains and redirects that require HTTPS/TLS from the initial request, a type of redirect that is not currently supported by other redirect solutions on the platform.</p> <p>This app uses CNAME/DNS SSL validation and can solve for a lot of different redirect scenarios. It might not be the best solution in all cases.</p> <p>It's best use case is handling incoming requests from vanity domains already on HTTPS, also called &quot;Secure to Secure&quot; redirects.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>You need to be on the RealPage VPN.
You will need to provide your public IP address to DevOps or OpEx (the app maintainers) so that your connection can be whitelisted.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> ipconfig.me -L
</code></pre></div><p>This will return your current public IP. We will whitelist a range of IP addresses around this.</p> <h2 id="point-the-domain"><a href="#point-the-domain" class="header-anchor">#</a> Point the Domain</h2> <p>Domains entered into the <code>domains</code> table should also have a CNAME or A Record added to their DNS entry with their registrar.</p> <p>The subdomains should have a CNAME entry pointing the domain to <code>domain-forwarder.g5dns.com</code>. This includes entries like <code>www.</code>.</p> <p>Domains usually don't accept a CNAME entry for their top-level record. Instead use an A record, pointed to the IP address <code>35.232.226.111</code>.</p> <h3 id="verify-domain-is-pointed"><a href="#verify-domain-is-pointed" class="header-anchor">#</a> Verify Domain is Pointed</h3> <p>Use <code>Dig</code> to get DNS records from your current DNS Server.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">dig</span> www.your-domain.com
<span class="token comment"># ANSWER SECTION:</span>
<span class="token comment"># www.your-domain.com TTL IN CNAME domain-forwarder.g5dns.com.</span>

<span class="token function">dig</span> your-domain.com
<span class="token comment"># ANSWER SECTION:</span>
<span class="token comment"># your-domain.com TTL IN A 35.232.226.111</span>
</code></pre></div><h2 id="add-a-domain-to-the-domains-table"><a href="#add-a-domain-to-the-domains-table" class="header-anchor">#</a> Add a Domain to the Domains Table</h2> <ol><li>Search that the domain doesn't already exist. <em>This is easiest to do using a SQL Query</em>.</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token keyword">public</span><span class="token punctuation">.</span>domains
<span class="token keyword">WHERE</span> domain <span class="token operator">=</span> <span class="token string">'www.the-domain-i-want-to-add.com'</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>No results means it doesn't exist. Please continue.</p></blockquote> <ol start="2"><li>Add the domain to the domains table. The <code>domain</code>, <code>createdAt</code>, and <code>updatedAt</code> fields are <strong>required</strong>. Set <code>createdAt</code> and <code>updatedAt</code> to today's date. Take note of the <code>id</code> that is created; you'll use it in the next step.</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">public</span><span class="token punctuation">.</span>domains<span class="token punctuation">(</span><span class="token string">&quot;domain&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;createdAt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;updatedAt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'my-new-domain.com'</span><span class="token punctuation">,</span> <span class="token string">'2022-04-19'</span><span class="token punctuation">,</span> <span class="token string">'2022-04-19'</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNING</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;domain&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="add-the-redirect-rules-to-the-redirect-table"><a href="#add-the-redirect-rules-to-the-redirect-table" class="header-anchor">#</a> Add the Redirect Rules to the Redirect Table</h2> <p>You can add multiple redirects for a single domain.</p> <ul><li>The <code>domain_id</code> should equal the <code>id</code> from your added domain.</li> <li>The <code>path</code> field is from root. a <code>/</code> means the homepage.</li> <li>The <code>destination</code> is where the domain + path should end up.</li> <li>The <code>secure_destination</code> should be set to true. If you aren't doing this, you probably shouldn't be using this service for your redirect.</li> <li>The <code>wildcard</code> should be set to true, but I don't know what it does currently.</li></ul> <blockquote><p>Since you can add multiple redirects for the same domain, redirects may overlap or conflict. In general, your more specific redirects (like page-level) should come before more broad ones (site-wide).</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">public</span><span class="token punctuation">.</span>redirects<span class="token punctuation">(</span><span class="token string">&quot;domain_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;destination&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;secure_destination&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wildcard&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;createdAt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;updatedAt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'www.new-domain.com'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token string">'2022-04-19'</span><span class="token punctuation">,</span> <span class="token string">'2022-04-19'</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNING</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">;</span>

</code></pre></div><p>You don't have to do this via SQL, but including just an option so you know which fields are required.</p> <h3 id="verify-that-redirects-are-working"><a href="#verify-that-redirects-are-working" class="header-anchor">#</a> Verify That Redirects are Working</h3> <p>The <code>domain_id</code> value plus <code>path</code> should arrive at the <code>destination</code> and can be tested in the browser.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> -vI https://<span class="token operator">&lt;</span>incoming_domain<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>redirect_path<span class="token operator">&gt;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> Location
</code></pre></div><h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <p>Since you will be modifying the database directly, you can break the whole thing if you aren't careful. For instance, do not redirect domains to themselves.</p> <p>View the tables with a join.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> domain<span class="token punctuation">,</span> path<span class="token punctuation">,</span> destination
<span class="token keyword">FROM</span> redirects
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> domains
<span class="token keyword">ON</span> redirects<span class="token punctuation">.</span>domain_id <span class="token operator">=</span> domains<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/opex-runbook/postgres/" class="prev">
        All Things Postgres
      </a></span> <span class="next"><a href="/opex-runbook/contributing/">
        Contributing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/opex-runbook/assets/js/app.b1c4424b.js" defer></script><script src="/opex-runbook/assets/js/2.83008ae0.js" defer></script><script src="/opex-runbook/assets/js/10.5dba1746.js" defer></script>
  </body>
</html>
